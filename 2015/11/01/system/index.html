<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Notes on the Google File System | 老古董的blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The google file system is a scalable distributed file system for large distributed data-intensive applications. It is designed to meet the specific storage need from the Google application workloads a">
<meta property="og:type" content="article">
<meta property="og:title" content="Notes on the Google File System">
<meta property="og:url" content="http://williamral.github.io/2015/11/01/system/index.html">
<meta property="og:site_name" content="老古董的blog">
<meta property="og:description" content="The google file system is a scalable distributed file system for large distributed data-intensive applications. It is designed to meet the specific storage need from the Google application workloads a">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Notes on the Google File System">
<meta name="twitter:description" content="The google file system is a scalable distributed file system for large distributed data-intensive applications. It is designed to meet the specific storage need from the Google application workloads a">
  
    <link rel="alternative" href="/atom.xml" title="老古董的blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="http://hdn.xnimg.cn/photos/hdn321/20140606/1635/h_large_fpIs_27f5000214551986.jpg" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">FuB&#39;s Notes</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/WilliamRal" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/1551328402/profile?topnav=1&wvr=6" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/LAOGUDONG" title="zhihu">zhihu</a>
					        
								<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/view?id=129100135&trk=nav_responsive_tab_profile" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Django/" style="font-size: 10px;">Django</a><a href="/tags/File-System/" style="font-size: 10px;">File System</a><a href="/tags/Java/" style="font-size: 10px;">Java</a><a href="/tags/算法/" style="font-size: 20px;">算法</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">FuB&#39;s Notes</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://hdn.xnimg.cn/photos/hdn321/20140606/1635/h_large_fpIs_27f5000214551986.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">FuB&#39;s Notes</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/WilliamRal" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/1551328402/profile?topnav=1&wvr=6" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/LAOGUDONG" title="zhihu">zhihu</a>
			        
						<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/view?id=129100135&trk=nav_responsive_tab_profile" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="google_file-system" class="article article-type-google_file" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/01/system/" class="article-date">
  	<time datetime="2015-11-01T18:20:00.000Z" itemprop="datePublished">2015-11-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Notes on the Google File System
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/File-System/">File System</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The google file system is a scalable distributed file system for large distributed data-intensive applications. It is designed to meet the specific storage need from the Google application workloads and reflect a marked departure from earlier file system. </p>
<h1 id="Workload_and_technological_environment_analysis">Workload and technological environment analysis</h1><blockquote>
<ul>
<li>Component failures are norm rather than exception.</li>
<li>Files are huge in traditional standards, multi-GB files are common. </li>
<li>Most files are mutated by appending rather than overwriting.</li>
<li>Co-design application and the file system API is possible. It is satisfiable to provide more relaxed APIs.</li>
</ul>
</blockquote>
<h1 id="Design_Assumptions">Design Assumptions</h1><blockquote>
<ul>
<li>The system is built on inexpensive commodity components that often fall.</li>
<li>The system stores a modest number of large files.</li>
<li>Primary read workloads are large streaming reads and small random reads.</li>
<li>Primary write workloads are large sequential append, many clients often append to the same file concurrently.</li>
<li>High bandwidth is more important than low latency.</li>
</ul>
</blockquote>
<a id="more"></a>   
<h1 id="Interface">Interface</h1><p>Files are organized hierarchically in directories and identified by pathnames. The system support <i>create, delete, open, close, read</i> and <i>write </i>files. The system also support <b>snapshot</b> and <b>record append</b> operations. Snapshot creates a copy of a file or directory tree at low cost. Record append allows multiple clients to append data to same file concurrently.</p>
<h1 id="Architecture">Architecture</h1><p>The file system is consist of a single <i>master</i>, multiple <i>chunkservers</i> and accessd by multiple <i>clients</i>. Files are divided into fixed-size <i>chunks</i>, each one identified by a globally unique 64 bit <i>chunk handle</i>, which is assigned by master at creation time.Chunkservers store chunks on local disks as Linux files. Each chunk is replicated on mutiple chunkservers for reliability. </p>
<p>The master maintains all file system <b>metadata</b>, including namespaces, access control info, mapping from files to chunk, and current location of chunks.</p>
<p>The master also controls system-wide activities such as chunk lease management, garbage collection of orphant chunks, and chunk migration. The master periodically communicates with each chunkserver in <b>HeartBeat</b> message to give instructions and collect state.</p>
<p>No cache on client or chunkserver. (chunkserver has Linux’s buffer cache).</p>
<h2 id="Single_Master">Single Master</h2><p>Clients never read or write file data through master. Instead, it asks the master which chunkserver to contact and caches it for a limited time, and interacts with the chunkservers directly. A simple read has following steps:</p>
<ol>
<li>The client translates the file name and byte offset specified by the application into a chunk index within the file.</li>
<li>Send master a request with filename and chunk index. (Maybe several chunks)</li>
<li>Master replies with chunk handle and location.</li>
<li>The client caches this info using filename and chunk index as key.</li>
<li>Client send a request to a replica, which specifies the chunk handle and a byte range. </li>
</ol>
<p>Chunk size is 64MB. </p>
<h2 id="Metadata">Metadata</h2><p>There are three kinds of metadata on master.</p>
<ul>
<li>The file and chunk namespace (also logged)</li>
<li>The mapping from files to chunks (also logged)</li>
<li>The location of each chunk’s replicas. </li>
</ul>
<p>All metadata are stored in memory, the first two are also stored persistently by <b>operation log</b>. The master asks chunkserver about its chunks at startup or a chunkserver joins the cluster.</p>
<h3 id="Operation_Log">Operation Log</h3><p>The operation log contains a historical record of critical metadata changes. It is the only persistent record of metadata, serves as a logical time line that difines the order of concurrent operations. The log must be reliable and modified before any changes visible to clients. So it is replicated on multiple remote machines and respond to a client operation only after flushing the corresponding log record on disk both locally and remotely.The master can recover its file system state by replaying the operation log.</p>
<h2 id="Consistency_Model">Consistency Model</h2><p>File namespace mutations (e.g., file create) are atomic.</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">Write</th>
<th style="text-align:right">Record Append</th>
</tr>
</thead>
<tbody>
<tr>
<td>Serial Success</td>
<td style="text-align:center">Defined</td>
<td style="text-align:right">Defined, interspersed with inconsistency</td>
</tr>
<tr>
<td>Concurrent Success</td>
<td style="text-align:center">Consistent</td>
<td style="text-align:right">Same as above</td>
</tr>
<tr>
<td>Failure</td>
<td style="text-align:center">Inconsistent</td>
<td style="text-align:right">Inconsistent</td>
</tr>
</tbody>
</table>
<p>A file region is <b>consistent</b> if all clients will always see the same data, regardless of which replica it reads from. A region is <b>defined</b> after a file data mutation if it is consistent and clients will see what the mutation writes in its entirety.</p>
<p>A record append causes data to be appended <i>atomically at least once</i>, but at an offset of GFS’s choosing. The offset is returned to the client. GFS may insert padding or record replicas in between, makes it inconsistent.</p>
<p>After a sequence of successful mutations, the mutated file region is guaranteed to be defined and contain the data written by the last mutation.</p>
<p>GFS applications should rely on appends rather than overwrites, checkpointing, write self-validating, self-identifying records. <b>Appending</b> is far more efficient and more resilient to application failures than random writes.<b>Checkpointing</b> allows writers to restart incrementally and keeps readers from processing successfully written file data that is still incomplete from the application’s perspective.</p>
<h1 id="System_Interactions">System Interactions</h1>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/11/01/django/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Django Notes</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="system" data-title="Notes on the Google File System" data-url="http://williamral.github.io/2015/11/01/system/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>



</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 FuB&#39;s Notes
    	</div>
      	<div class="footer-right">
      		Fub Loves Xochitl
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>